<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Lotes - Admin</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-view">
        <div class="login-container">
            <img src="logo.png" alt="Logo" class="logo-login">
            <h2>Gestor de Lotes</h2>
            <p>Acceso de Vendedor</p>
            <form id="login-form">
                <input type="email" id="login-email" placeholder="Tu correo electr√≥nico" required>
                <input type="password" id="login-password" placeholder="Tu contrase√±a" required>
                <button type="submit">Ingresar</button>
            </form>
            <p id="login-error-message" class="error-message"></p>
        </div>
    </div>

    <div id="admin-view" class="hidden">
        <header class="admin-header">
            <div class="header-section header-left">
                <img src="logo.png" alt="Logo" class="logo-panel">
                <h1>Panel de Control</h1>
            </div>
            <div class="header-section header-center">
                <button id="open-report-modal-button" class="btn-secondary">üìä Reportes</button>
            </div>
            <div class="header-section header-right">
                <button id="logout-button">Cerrar Sesi√≥n</button>
            </div>
        </header>

        <nav class="main-nav">
            <button data-view="lotes" class="nav-button active">üèûÔ∏è Lotes</button>
            <button data-view="clientes" class="nav-button">üë§ Clientes</button>
            <button data-view="comprobantes" class="nav-button">üìÑ Comprobantes</button>
            <button data-view="config" class="nav-button">üß± Bolsa de Cemento</button>
        </nav>
        
        <main id="lotes-content" class="content-view">
            <div class="form-column">
                <section class="admin-section">
                    <h3 id="lote-form-title">Agregar Nuevo Lote</h3>
                    <form id="lote-form">
                        <input type="hidden" id="lote-id">
                        <input type="text" id="lote-manzana" placeholder="N√∫mero de Manzana" required>
                        <input type="text" id="lote-numero" placeholder="N√∫mero de Lote" required>
                        <input type="number" id="lote-metros" placeholder="Metros Cuadrados (m¬≤)" required>
                        <input type="text" id="lote-bolsas" placeholder="Valor en Bolsas de Cemento (ej: 14,5)" required>
                        <select id="lote-estado" required>
                            <option value="Disponible">Disponible</option>
                            <option value="Reservado">Reservado</option>
                            <option value="Vendido">Vendido</option>
                        </select>
                        <button type="submit" class="btn-primary">Guardar Lote</button>
                    </form>
                </section>
            </div>
            <div class="list-column">
                <section class="admin-section">
                    <div class="toolbar">
                        <h3>Inventario de Lotes</h3>
                        <p>Valor Cemento: <strong id="cemento-valor-display-lotes">Cargando...</strong></p>
                    </div>
                    <div id="lotes-list"></div>
                </section>
            </div>
        </main>

        <main id="clientes-content" class="content-view hidden">
             <div class="form-column">
                <section class="admin-section">
                    <h3 id="cliente-form-title">Agregar Nuevo Cliente</h3>
                    <form id="cliente-form">
                        <input type="hidden" id="cliente-id">
                        <input type="text" id="cliente-nombre" placeholder="Nombre y Apellido" required>
                        <input type="text" id="cliente-dni" placeholder="DNI" required>
                        <input type="text" id="cliente-telefono" placeholder="Tel√©fono">
                        <input type="text" id="cliente-telefono-alt" placeholder="Tel√©fono Alternativo">
                        <input type="email" id="cliente-email" placeholder="Correo Electr√≥nico">
                        <input type="text" id="cliente-residencia" placeholder="Lugar de Residencia">
                        <button type="submit" class="btn-primary">Guardar Cliente</button>
                    </form>
                </section>
            </div>
            <div class="list-column">
                <section class="admin-section">
                     <div class="toolbar">
                        <h3>Lista de Clientes</h3>
                        <input type="search" id="cliente-search" placeholder="Buscar por DNI o Nombre...">
                    </div>
                    <div id="clientes-list"></div>
                </section>
            </div>
        </main>

        <main id="comprobantes-content" class="content-view hidden">
            <div class="list-column-single">
                 <section class="admin-section">
                    <div class="toolbar">
                        <h3>Comprobantes Pendientes</h3>
                    </div>
                    <div id="comprobantes-list"></div>
                </section>
            </div>
        </main>

        <main id="config-content" class="content-view hidden">
            <div class="form-column-single">
                <section class="admin-section">
                    <h3>Valor de Referencia</h3>
                    <form id="config-form">
                        <label for="precio-cemento">Valor Actual de la Bolsa de Cemento (ARS)</label>
                        <input type="text" id="precio-cemento" placeholder="Ej: 9500,50" required>
                        <button type="submit" class="btn-primary">Actualizar Valor</button>
                    </form>
                </section>
            </div>
        </main>
    </div>

    <div id="modal-container" class="modal-overlay hidden">
        
        <div id="asignar-lote-modal" class="modal-content hidden">
             <button class="close-modal-button">&times;</button>
             <h2>Asignar Lote</h2>
             <p>Asignando lote a: <strong id="asignar-cliente-nombre"></strong></p>
             <form id="asignar-lote-form">
                 <label for="select-lote-disponible">Seleccionar un lote disponible:</label>
                 <select id="select-lote-disponible" required></select>
                 <button type="submit" class="btn-primary">Confirmar Asignaci√≥n</button>
             </form>
        </div>

        <div id="pagos-modal" class="modal-content hidden">
            <button class="close-modal-button">&times;</button>
            <h2>Gesti√≥n de Pagos</h2>
            <div id="pago-info-cliente" class="summary"></div>
            <div id="pago-info-lote" class="summary"></div>
            <section class="admin-section">
                <h3>Registrar Nuevo Pago</h3>
                <form id="pago-form">
                    <label for="pago-concepto">Concepto (Ej: Cuota 1, Entrega)</label>
                    <input type="text" id="pago-concepto" placeholder="Detalle del pago" required>
                    <label for="pago-bolsas">Cantidad de Bolsas a Abonar</label>
                    <input type="text" id="pago-bolsas" placeholder="Ej: 14,5" required>
                    <p class="monto-a-cobrar">Monto a cobrar (ARS): <strong id="pago-monto-calculado">$0,00</strong></p>
                    
                    <div id="adjuntar-comprobante-section">
                        <h4>Adjuntar Comprobante</h4>
                        <select id="select-comprobante-disponible">
                            <option value="">-- No adjuntar --</option>
                        </select>
                        <button id="ver-comprobante-adjuntar" type="button" class="btn-secondary">Ver Adjunto</button>
                    </div>

                    <button type="submit" class="btn-primary">Registrar Pago</button>
                </form>
            </section>
            <section class="admin-section">
                <h3>Historial de Movimientos</h3>
                <div id="pagos-historial"></div>
            </section>
        </div>
        
        <div id="edit-comprobante-modal" class="modal-content hidden">
             <button class="close-modal-button">&times;</button>
             <h2>Editar Informaci√≥n del Comprobante</h2>
             <form id="edit-comprobante-form">
                 <label for="edit-comprobante-mes-pago">Mes de Pago</label>
                 <select id="edit-comprobante-mes-pago" required>
                     <option value="Enero">Enero</option>
                     <option value="Febrero">Febrero</option>
                     <option value="Marzo">Marzo</option>
                     <option value="Abril">Abril</option>
                     <option value="Mayo">Mayo</option>
                     <option value="Junio">Junio</option>
                     <option value="Julio">Julio</option>
                     <option value="Agosto">Agosto</option>
                     <option value="Septiembre">Septiembre</option>
                     <option value="Octubre">Octubre</option>
                     <option value="Noviembre">Noviembre</option>
                     <option value="Diciembre">Diciembre</option>
                 </select>
                 <button type="submit" class="btn-primary">Guardar Cambios</button>
             </form>
        </div>


        <div id="report-modal" class="modal-content hidden">
            <button class="close-modal-button">&times;</button>
            <h2>Generar Reporte de Ventas</h2>
            <form id="report-filters-form">
                <label for="report-client-select">Seleccionar Cliente</label>
                <select id="report-client-select">
                    <option value="todos">Todos mis clientes</option>
                </select>
                <label for="report-start-date">Desde la Fecha</label>
                <input type="date" id="report-start-date">
                <label for="report-end-date">Hasta la Fecha</label>
                <input type="date" id="report-end-date">
                <button type="submit" class="btn-primary">Generar y Descargar CSV</button>
            </form>
        </div>
        
        <div id="comprobante-viewer-modal" class="modal-content hidden">
            <button class="close-modal-button">&times;</button>
            <h2>Ver Comprobante</h2>
            <div id="comprobante-viewer-content"></div>
            <button id="btn-editar-info-comprobante" class="btn-secondary">Editar Informaci√≥n</button>
        </div>
        
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.44.4/dist/umd/supabase.min.js"></script>
    <script src="supabase-client.js"></script>
    <script src="app.js"></script>
</body>
</html>